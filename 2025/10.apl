'memo' 'cache'⎕CY'dfns'

f ← ' '(≠⊆⊢)¨⊃⎕NGET'in/10.txt'1
b ← {↑(⍸⍣¯1,)¨⍎¨¯1↓1↓⍵}¨f
C ← {⍵,⍪/0 1,¨⊢/⍵}⍣(⌈/≢¨b)⊂1 0⍴0

⎕← +/b{⌊/+⌿2⊥⍣¯1⍸⍵∧.=⍉2|⍺+.×⍨C⊃⍨≢⍺}∘{'#'=¯1↓1↓⊃⍵}¨f
⎕← +/b{
    p ← C⊃⍨≢⍺
    o ← p+.×⍺
    f ← {
        0>⌊/⍵: 9e9
        0∧.=⍵: 0
        n ← +/p[i←⍸⍵∧.=⍥(2|⊢)⍉o;]
        ⌊/9e9,n+2×f¨.5×(⊂⍵)-↓o[i;]
    }memo(cache⍬)
    f⍎¯1↓1↓⊃⌽⍵
}¨f
