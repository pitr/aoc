g m ← {⍵⊆⍨×≢¨⍵}⊃⎕NGET'in/15.txt'1
M ← ¯1 1 0j¯1 0j1['<>^v'⍳∊m]
∆ ← {0 1∘.+⍵+9○⍵}

w b r ← '#O@'∘.{+/↑0j1 1∘×¨⍸⍺=⍵}⊂↑g
B ← b
next ← { ⍵+b[⍸b∊m]+←⍺×~∨/w∊⍺+m←⍺{∪⍵,b∩⍺+⍵}⍣≡⍵ }
⎕← +/100 1+.×11 9∘.○b⊣ next/⌽r,M

w ← ∊∆ w
b c ← ↓∆ B
next ← { ⍵+c[i]+←b[i←⍸b∊m]+←⍺×~∨/w∊⍺+m←⍺{∪⍵,∊b c/⍨¨b c∨.∊⊂⍺+⍵}⍣≡⍵ }
⎕← +/100 1+.×11 9∘.○b⊣ next/⌽(⊃∆ r),M
