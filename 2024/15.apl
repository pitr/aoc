g m ← {⍵⊆⍨×≢¨⍵}⊃⎕NGET'in/15.txt'1
M ← 0j1*'>v<^'⍳∊m

w b r ← '#O@'∘.{+⌿0j1×@0⍉↑⍸⍺=⍵}⊂↑g
B ← b
next ← { ⍵+b[⍸b∊m]+←⍺×~∨/w∊⍺+m←⍺{⍵∪b∩⍺+⍵}⍣≡⍵ }
⎕← +/100 1+.×11 9∘.○b⊣ next/⌽r,M

w b r ← {⍵+9○⍵}¨w B r
w,← 1+w
next ← { ⍵+b[⍸b∊m]+←⍺×~∨/w∊⍺+m←⍺{⍵∪m,1+m←b∩⍺+⍵,⍵-1}⍣≡⍵ }
⎕← +/100 1+.×11 9∘.○b⊣ next/⌽r,M
