n ← ⊃⎕NGET'in/21.txt'1
N ← ⍎¨n/⍨¨n∊¨⊂⎕D
C ← 6 3⍴'789456123 0A ^a<v>'

step ← {
    s t ← ⍺⍵(⊃∘⍸=)¨⊂C
    d ← t-s
    v h ← (|d)/¨(1+×d)⊃¨'^.v' '<.>'
    flip ← ((⊢/0>d) ∨ ' '=C[⊂0 1⊃¨t s]) ∧ ' '≠C[⊂0 1⊃¨s t]
    flip: h,v,'a'
    v,h,'a'
}
run ← { ⌽↓⍉n{⍺,+/⍵}⌸⍥(⊃,/)⍺+0⊣¨¨n←2step/¨'aA'[1=≢⍵],¨⍵ }
len ← {⍺+.×≢¨⍵}
⎕← N+.×len/¨(⊃run/)¨⍣3⊢(1,⊂∘⊂)¨n
⎕← N+.×len/¨(⊃run/)¨⍣26⊢(1,⊂∘⊂)¨n
