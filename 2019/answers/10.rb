def day10_1(inp)
  ps=Set.new
  inp.lines.each_with_index{|l,y|l.strip.split('').each_with_index{|c,x|ps<<Complex(x, y) if c=='#'}}
  ds=Hash.new(0)
  ps.to_a.combination(2).each do |i,j|
    s = [(i.real-j.real).abs,(i.imag-j.imag).abs].max
    if 1.upto(s-1).all? { |ss|
      dx = (j.real-i.real)*ss
      dy = (j.imag-i.imag)*ss
      dx % s != 0 or dy % s != 0 or !ps.include?(Complex(i.real+dx/s,i.imag+dy/s))
    }
      ds[i]+=1;ds[j]+=1
      p [i,j] if i==Complex(8,0) or j==Complex(8,0)
    end
  end
  ds.max_by { |k,v| v }
end

day10_1(""".#..#
.....
#####
....#
...##""") # => 3,4 8

day10_1("""......#.#.
#..#.#....
..#######.
.#.#.###..
.#..#.....
..#....#.#
#..#....#.
.##.#..###
##...#..#.
.#....####""") # => 5,8 33

day10_1("""#.#...#.#.
.###....#.
.#....#...
##.#.#.#.#
....#.#.#.
.##..###.#
..#...##..
..##....##
......#...
.####.###.""") # => 1,2 35

day10_1(""".#..#..###
####.###.#
....###.#.
..###.##.#
##.##.#.#.
....###..#
..#.#..#.#
#..#.#.###
.##...##.#
.....#.#..""") # => 6,3 41

day10_1(""".#..##.###...#######
##.############..##.
.#.######.########.#
.###.#######.####.#.
#####.##.#.##.###.##
..#####..#.#########
####################
#.####....###.#.#.##
##.#################
#####.##.###..####..
..######..##.#######
####.##.####...##..#
.#####..#.######.###
##...#.##########...
#.##########.#######
.####.#.###.###.#.##
....##.##.###..#####
.#.#.###########.###
#.#.#.#####.####.###
###.##.####.##.#..##""") # => 11,13 210

day10_1(File.read('10.txt'))



def day10_2(inp, p, times)
  ps=Set.new
  inp.lines.each_with_index{|l,y|l.strip.split('').each_with_index{|c,x|ps<<Complex(x, y) if c=='#'}}
  ds=Hash.new(0)
  ps.to_a.combination(2).each do |i,j|
    s = [(i.real-j.real).abs,(i.imag-j.imag).abs].max
    if 1.upto(s-1).all? { |ss|
      dx = (j.real-i.real)*ss
      dy = (j.imag-i.imag)*ss
      dx % s != 0 or dy % s != 0 or !ps.include?(Complex(i.real+dx/s,i.imag+dy/s))
    }
      ds[i]+=1;ds[j]+=1
      p [i,j] if i==Complex(8,0) or j==Complex(8,0)
    end
  end
  ds.max_by { |k,v| v }
end

day10_2(""".#..##.###...#######
##.############..##.
.#.######.########.#
.###.#######.####.#.
#####.##.#.##.###.##
..#####..#.#########
####################
#.####....###.#.#.##
##.#################
#####.##.###..####..
..######..##.#######
####.##.####...##..#
.#####..#.######.###
##...#.##########...
#.##########.#######
.####.#.###.###.#.##
....##.##.###..#####
.#.#.###########.###
#.#.#.#####.####.###
###.##.####.##.#..##""") # => 11,13 210

day10_2(File.read('10.txt'),Complex(23,29),1)
